---
title: "Deployment Planning"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(reticulate)
library(leaflet)
```

This page is used for Canadian Argo groups to coordinate deployment planning, in addition to [OceanOps](https://www.ocean-ops.org/board?t=argo). To submit plans to the website, see instructions on the [github page](https://github.com/ArgoCanada/blog/tree/master/deployment).

```{python data}
import pandas as pd

df = pd.read_csv('deployment/canada_deployments.csv')
df['DEPLOYMENT DATE'] = df['DEPLOYMENT DATE'].apply(pd.Timestamp)
df = df.loc[df['DEPLOYMENT DATE'] > pd.Timestamp('01-01-2023')]
df = df.sort_values('DEPLOYMENT DATE')
df['DEPLOYMENT DATE'] = [d.strftime('%d %b, %Y') for d in df['DEPLOYMENT DATE']]
df['WMO'] = [str(int(w)) if pd.notna(w) else '' for w in df.WMO]
df['IMEI'] = [str(int(i)) if pd.notna(i) else '' for i in df.IMEI]
df['SERIAL NUMBER'] = [s if pd.notna(s) else '' for s in df['SERIAL NUMBER']]

mapper = {
    	'PROGRAM':'Program',
        'INSTITUTE':'Institute',
        'STATUS':'Status',
        'MODEL':'Model',
        'DEPLOYMENT DATE':'Date',
        'DEPLOYMENT LAT':'Latitude',
        'DEPLOYMENT LON':'Longitude',
        'DEPLOYMENT SHIP':'Ship',
        'SERIAL NUMBER':'Serial No.',
}

df = df.rename(columns=mapper)
df = df.reset_index().drop('index', axis=1)

recent = df.loc[df.Status == 'OPERATIONAL'].drop('Status', axis=1).reset_index().drop('index', axis=1)
plan   = df.loc[df.Status != 'OPERATIONAL'].drop('Status', axis=1).reset_index().drop('index', axis=1)
```

```{r map, layout="l-page-outset"}
pal <- colorFactor(c("green", "orange","navy", "yellow"), levels=c("BIO", "IOS", "ONC", "Dal"))
leaflet() %>% addTiles() %>%
  setView(lng=-60, lat=45 , zoom = 2) %>% 
  addCircleMarkers(
    data=py$df,
    lat=py$df$Latitude,
    lng=py$df$Longitude,
    radius = ~ifelse(py$df$Status == "OPERATIONAL", 10, 6),
    stroke=FALSE,
    fillColor=~pal(py$df$Institute),
    fillOpacity=0.7,
    popup=paste0(
      "WMO: ", py$df$WMO,
      "<br/>", 
      "Model: ", py$df$Model,
      "<br/>", 
      "Program: ", py$df$Program, ", ", py$df$Institute
    )
  )
```

## Deployments since Jan 1, 2023

```{r table_1, layout="l-page-outset shaded"}
knitr::kable(py$recent)
```
## Planned Deployments

```{r table_2, layout="l-page-outset shaded"}
knitr::kable(py$plan)
```

### Other Deployment Information

Although there is not yet a designated cruise or location, Argo Canada is sending 6 ARVOR floats to Cape Town, South Africa via the RRS Discovery. These floats will be deployed in the Western Indian Ocean where there is a significant gap in the Argo array.

## Inventory

```{python inventory}
stock = pd.read_csv('deployment/inventory.csv')

remain = pd.DataFrame({
    'Program':stock.Program,
    'Institute':stock.Institute,
    'ARVOR':stock['ARVOR'] + stock['ARVOR+DO'] + stock['ARVOR-RBR'],
    'Deep ARVOR':stock['Deep ARVOR'],
    'PROVOR':stock['PROVOR']
})

remain = remain.set_index(['Program', 'Institute'], drop=False)

for i in plan.index:
    ix = (plan.loc[i].Program, plan.loc[i].Institute)
    f = plan.loc[i].Model
    remain.loc[ix][f] -= 1

```

The table below shows the number of "in stock" floats for each program/institution.

```{r table_3, layout="l-body-outset shaded"}
knitr::kable(py$stock)
```

This table shows what the standing stock of floats will be for each program/institution will be following the completion of the deployments listed in the "Planned Deployments" section. For simplicity, all types of ARVOR models (except deep) are combined here.

```{r table_4, layout="l-body-outset shaded"}
knitr::kable(py$remain)
```
